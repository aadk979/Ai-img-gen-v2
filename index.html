<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Generator</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Custom CSS for styling */
        .card {
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 20px;
        }

        .form-group label {
            font-weight: bold;
        }

        #imageContainer {
            max-width: 100%;
            max-height: 80vh;
            overflow: auto;
            border-radius: 10px;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #f9f9f9;
        }

        .download-btn {
            margin-top: 10px;
        }

        .loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: red;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-9">
            <div class="card">
                <div class="card-body">
                    <h1 class="mb-4">Image Generator</h1>

                    <!-- Form to select model and input prompt -->
                    <form id="imageForm">
                        <div class="form-group">
                            <label for="modelSelect">Select Model:</label>
                            <select class="form-control" id="modelSelect">
                                <option value="Ojimi/anime-kawai-diffusion">Anime Kawai Diffusion</option>
                                <option value="cagliostrolab/animagine-xl-3.0">Animagine XL 3.0</option>
                                <option value="Lykon/dreamshaper-xl-v2-turbo">Dreamshaper XL V2 Turbo</option>
                                <option value="fluently/Fluently-anime">Fluently anime</option>
                                <option value="LottePeisch/RevAnimated-Diffusers">RevAnimated Diffusers</option>
                                <option value="Yntec/WesternAnimation">WesternAnimation</option>
                                <option value="digiplay/CleanLinearMix_nsfw">CleanLinearMix</option>
                                <option value="stablediffusionapi/newrealityxl-global-nsfw">newrealityxl global</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="inputPrompt">Input Prompt:</label>
                            <input type="text" class="form-control" id="inputPrompt" placeholder="Enter input prompt">
                        </div>
                        <button type="submit" class="btn btn-primary">Generate Image</button>
                    </form>
                </div>
            </div>Â 
            <div class="row mt-3">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <!-- Container to display generated image and download button -->
                            <div id="imageContainer"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS and Fetch Polyfill (for older browsers) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-detection"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

<script>
    document.getElementById('imageForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        // Disable the generate button and show loading spinner
        const generateButton = document.querySelector('button[type="submit"]');
        generateButton.disabled = true;
        generateButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Generating...';

        const modelSelect = document.getElementById('modelSelect').value;
        const inputPrompt = document.getElementById('inputPrompt').value;

        try {
            const response = await fetchImage(modelSelect, { "inputs": inputPrompt });
            const imageUrl = URL.createObjectURL(response);

            // Display image and download button in container
            document.getElementById('imageContainer').innerHTML = `
                <img src="${imageUrl}" class="img-fluid" alt="Generated Image" style="max-width: 100%;">
                <a href="${imageUrl}" download="generated_image.jpg" class="btn btn-success download-btn ml-2">Download Image</a>
            `;
        } catch (error) {
            console.error('Error fetching image:', error);
        } finally {
            // Enable the generate button and reset its text
            generateButton.disabled = false;
            generateButton.innerHTML = 'Generate Image';
        }
    });

    async function fetchImage(model, data) {
        const xxx = localStorage.getItem('Bearer');
        const response = await fetch(
            `https://api-inference.huggingface.co/models/${model}`,
            {
                headers: { Authorization: "Bearer " + xxx },
                method: "POST",
                body: JSON.stringify(data),
            }
        );
        const result = await response.blob();
        return result;
    }

</script>

</body>
</html>
